# Fresnel

Fresnel is an automated tool for creating and comparing
performance reports about web pages.


## Getting started

Install Fresnel from npm. [Node.js](https://nodejs.org/) 6 or later is required.

```
$ npm install -g fresnel
```

#### Configuration

Fresnel reads configuration from a `.fresnel.yml` file. This is also the
place to declare your performance scenarios.

A scenario consists of the following options:

* url: The browser will navigate to this url.
* viewport (optional): Viewport for the browser tab.

  This does not include the OS or browser UI. For example, a maximised
  window on a 1440x900 screen could have a viewport of 1440x790.

  Default: `{ width: 1100, height: 700 }`

  For additional viewport properties, see [puppeteer/Page.setViewport](https://pptr.dev/#?product=Puppeteer&version=v1.11.0&show=api-pagesetviewportviewport).
* reports: List of Fresnel reports to enable for this scenario.

  Available:
  - [`navtiming`](./API.md#module_reports/navtiming)
  - [`paint`](./API.md#module_reports/paint)
  - [`transfer`](./API.md#module_reports/transfer)
* probes: List of Fresnel probes to enable for this scenario.

  Available:
  - [`screenshot`](./API.md#module_probes/screenshot)
  - [`trace`](./API.md#module_probes/trace)

By default, Fresnel ships with a configuration file aimed at testing a
MediaWiki installation. Once Fresnel is ready for use, this will be moved
out and instead maintained and versioned in MediaWiki's Git repository. (TODO)

#### Usage

To record scenarios with Fresnel, run the `fresnel record` command.

Then, after changing the project under test, record the scenarios again.
This time, with a different label.

Lastly, compare the two recordings using `fresnel record`.

For example:

```
$ fresnel record "before"

$ fresnel record "after"

$ fresnel compare "before" "after"
```

## Contributing

Refer to [API.md](./API.md) for overview of how Fresnel works
internall, as well as function-level documentation.

To contribute, you'll want to install Fresnel directly from the
Git repository, and create a dynamic link for easy use from the
command-line:

```
$ git clone https://gerrit.wikimedia.org/r/performance/fresnel
$ cd fresnel/

fresnel$ npm install
fresnel$ npm link

# Then, use the 'fresnel' command
```

#### Build commands

* `npm run test` – Run the linter, tests and regenerate the docs. To run a single test only use `npx qunit path/to/test.js`
* `npm run doc` – Regenerate the docs.
* `npm run doc:dump` – List the available [JSDoc identifiers](https://github.com/jsdoc2md/jsdoc-to-markdown/wiki/Listing-namepaths) for intra-doc linking.

**Documentation**. Fresnel is documented with [JSDoc](http://usejsdoc.org/). The [API.md](./API.md) file is generated by [jsdoc2md](https://github.com/jsdoc2md/jsdoc-to-markdown/wiki). To render the Markdown files in a browser locally, you could [npm install -g md-fileserver](https://www.npmjs.com/package/md-fileserver) and then run `mdopen API.md`.

**Tests**. Fresnel is tested with [QUnit](https://api.qunitjs.com/assert/), using [nyc](https://istanbul.js.org/) for code coverage. The coverage report gets generated as part of the `npm run test` command. The nyc tool is configured in `package.json`. Run `npx nyc help config` to view its option documentation. View the code coverage report in a browser by opening the `.coverage/index.html` file.

## Release

The Fresnel project is primarily installed as a command-line tool,
not as a library. As such, it maintains an `npm-shrinkwrap.json` file
instead of a `package-lock.json` file.

* <https://docs.npmjs.com/files/package-locks>
* <https://docs.npmjs.com/cli/shrinkwrap>
